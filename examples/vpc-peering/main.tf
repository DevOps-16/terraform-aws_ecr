# ---------------------------------------------------------------------------------------------------------------------
# Create two VPC's inside the same AWS account with a peering connection
# This template creates an A VPC and a B VPC and shows how to create a VPC peering connection between them.
# ---------------------------------------------------------------------------------------------------------------------

provider "aws" {
  version = "~> 2.45"
  region  = var.aws_region
}

# ---------------------------------------------------------------------------------------------------------------------
# Create the A VPC
# ---------------------------------------------------------------------------------------------------------------------

module "a-vpc" {
  source     = "../../modules/vpc"
  cidr_block = "10.1.0.0/16"
}

# ---------------------------------------------------------------------------------------------------------------------
# Create the B VPC
# ---------------------------------------------------------------------------------------------------------------------

module "b-vpc" {
  source     = "../../modules/vpc"
  cidr_block = "10.2.0.0/16"
}

# ---------------------------------------------------------------------------------------------------------------------
# Create the Peering Connection
# ---------------------------------------------------------------------------------------------------------------------

module "vpc-peering" {
  source = "../../modules/vpc-peering"

  vpc_id        = module.a-vpc.id
  peer_vpc_id   = module.b-vpc.id
  peer_owner_id = "112233445566"

}
